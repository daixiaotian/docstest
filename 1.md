知金链存证业务接口

说明文档

V0.9.13

北京知金链网络技术有限公司

2018年05月

修改记录

| 序号 | 日期 | 内容 | 操作人员 |
|------|------|------|----------|
|      |      |      |          |
|      |      |      |          |
|      |      |      |          |
|      |      |      |          |
|      |      |      |          |
|      |      |      |          |
|      |      |      |          |
|      |      |      |          |
|      |      |      |          |
|      |      |      |          |

一、文档说明

1.  功能描述

本文档对合作方接入知金链平台的接口进行详细说明。

知金链存证平台为合作方提供电子文件存证、文件存证续期等业务。本接口说明文档定义了存证平台（服务方，即知金链存证平台）与合作方（存证业务客户方）之间的业务交互接口详情。系统业务接口有两类：知金链存证平台实现的接口及合作方实现的接口。

合作方通过存证业务接口，接入知金链存证平台，将需要存证的文件保存到存证业务平台。

1.  阅读对象

本文档订单阅读对象包括：了解Java、Python、Golang等开发语言的渠道方开发、维护、管理人员。

1.  业务术语

**知金链存证平台**:知金链存证平台是为用户提供文件存证、文件Hash存证、文件存证续期等业务的平台。以下简称“存证平台”。

**合作方**：合作方指知金链存证平台的合作方，即调用存证业务的平台。

**电子文件存证**：电子文件存证指合作方将待存证的源文件（或Hash值）以及存证描述信息一起发送给知金链存证平台的存证业务。

**格式化存证信息**：每个存证请求中，可以携带不大于500k的格式化描述信息。

**文件Hash存证**：文件Hash存证指合作方仅将存证描述信息传给知金链存证平台，而不上传存证源文件的存证业务。

**文件存证续期**：文件存证续期指合作方针对已有的存证订单，延长该订单存证时长的业务。

二 合作方注册

为了确认合作方的资格，进行文件存证、文件Hash存证、文件存证续期等业务，合作方需要在知金链存证平台进行注册。

在进行存证业务时，为了完成存证业务的数据交互，合作方也需要实现部分回调接口。

合作方在存证系统进行注册时需要提供基本信息以及存证业务通知回调地址。如不提供回调地址，则需要合作方主动通过查询接口获取订单的最新状态，以采取下一步操作。

1.  合作方对接流程

1 合作方通过知金链平台的合作方对接页面填写基本对接信息；

2 知金链平台进行信息审核，并与合作方核对相关信息，核对计费模式；

3
知金链平台将合作方的对接必须信息（合作方标识、接口访问标识等）、测试地址通过邮件发送给合作方；

4 合作方与知金链平台进行联调；

5 知金链平台将正式接口地址发送给合作方，完成正式接入。

1.  合作方提交基本信息接口

接口说明：

>   由知金链存证平台提供，供合作方调用，用于接受合作方基本信息和合作意向申请。

请求地址：

>   [/interface/create](http://cz.zhijl.com/interface/createFileAttest)*Channel*

接口形式：

Http页面。

参数说明：

| 信息项   | 必选 | 类型   | 长度 | 说明                   |
|----------|------|--------|------|------------------------|
| 公司名称 | true | String | 16   | 合作方公司名称         |
| 联系人   | true | String | 10   | 联系人姓名             |
| 联系电话 | true | String | 13   | 联系电话               |
| 电子邮箱 | true | String | 100  | 电子邮箱               |
| 业务说明 | true | String | 500  | 关于合作业务的说明信息 |

1.  合作方完善信息说明

>   当接受到合作方的合作申请并确认后，知金链平台需要提供基本的密钥工具等，然后由合作方提供如下各类信息，并生成对应的合作方标识信息。通过接口对接测试后，统一更新信息。

>   由知金链工作人员与合作方进行沟通完成。

合作方提供信息说明：

| 信息项               | 必选  | 类型   | 长度 | 说明                                                                                                                                        |
|----------------------|-------|--------|------|---------------------------------------------------------------------------------------------------------------------------------------------|
| 公司名称             | true  | String | 16   | 合作方名称                                                                                                                                  |
| 合作方公钥           | true  | String |      | 合作方的国密SM2算法公钥，hex形式提供。在进行存证业务的时候，合作方需要生成SM2密钥对，以对存证的业务数据进行签名。参见说明“合作方密钥生成”。 |
| 合作方类型           | true  | String | 2    | 合作方类型，可能的取值：1企业、2政府机关、3事业单位、4社会团体、5非盈利性组织、0其他                                                        |
| 营业执照             | true  | String | 50   | 合作方营业执照全称                                                                                                                          |
| 社会统一信用代码     | true  | String | 50   | 合作方社会统一信用代码                                                                                                                      |
| 创建时间             | true  | String | 6    | 合作方公司注册的时间                                                                                                                        |
| 银行账户             | false | String | 20   | 对公银行账户名，用于实名认证                                                                                                                |
| 银行账号             | false | String | 18   | 对公银行账号                                                                                                                                |
| 营业年限             | false | String | 3    | 整数                                                                                                                                        |
| 渠道方规模           | false | String | 5    | 100/300/500人                                                                                                                               |
| 主营业务             | false | String | 10   | 合作方的主营业务                                                                                                                            |
| 网址                 | false | String | 50   | 合作方网址                                                                                                                                  |
| 地址                 | false | String | 50   | 合作方地址                                                                                                                                  |
| 文件存证完成通知地址 | true  | String | 100  | 供存证平台调用，实现文件存证完成通知，详情参见“[文件存证完成通知接口](#文件存证完成通知接口)”。                                             |

知金链平台返回信息说明：

知金链平台接收到合作方完善的信息后，生成合作方的业务标识信息，开始接口测试。

| 参数名            | 数据项         | 必选 | 类型                                              | 长度 | 说明                                                                  |
|-------------------|----------------|------|---------------------------------------------------|------|-----------------------------------------------------------------------|
| channelId         | 合作方id       | true | String 3 平台根据渠道信息生成，是渠道的唯一标识。 | 4    | 平台根据合作方信息生成，是合作方的唯一标识。                          |
| accessKey         | 接口访问标识   | true | String                                            | 44   | 平台根据合作方的公钥生成，**业务请求参数**。                          |
| channelIDA        | 合作方标识     | true | String                                            | 50   | 合作方标识，用于合作方的签名算法。                                    |
| platformIDA       | 存证平台标识   | true | String                                            | 50   | 平台标识，用于平台的签名算法。                                        |
| platformPublicKey | 存证平台的公钥 | true | String                                            | 100  | 存证平台签名用的公钥。用于校验存证平台的签名                          |
| testAddr          | 测试接口地址   | true | String                                            | 100  | 具体的接口模式为：testAddr+接口相对地址。 示例：*http://cz.zhijl.com* |

三 存证业务接口

1.  流程说明

存证业务的功能为接收用户上传的图片、文档等文件，进行存证。文件存证业务流程如下图所示：

![](media/a525d8f5caffcc225a058bb94f9edf0a.png)

>   图1 文件存证业务流程图

业务流程说明：

1、合作方发起文件存证业务，调用存证平台的“文件存证”接口，将存证的详细业务信息提交给知金链存证平台。

2、知金链存证平台对文件存证请求进行安全、权限、数据格式校对、电子存储文件处理、存证信息上区块链等一系列业务处理后，调用合作方的“文件存证通知”接口，通知合作方存证业务的状态。

1.  存证平台接口

2.  接口说明

由知金链存证平台提供，供合作方调用，用于接收文件存证请求的详细业务信息。注意最终存证的开始时间以存证平台返回的为准，存证持续时间不变。

所有参数必须经过utf-8编码的urlencode。

1.  请求地址

>   [/interface/createFileAttest](http://cz.zhijl.com/interface/createFileAttest)

1.  接口形式

>   Http POST请求。

1.  请求参数

| 参数名         | 数据项          | 必选  | 类型   | 长度 | 说明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|----------------|-----------------|-------|--------|------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| signType       | 签名类型        | true  | String | 10   | 请求的签名类型，目前固定值"MD5"。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| sign           | 签名            | true  | String | 24   | 本次请求的参数签名。签名方法参见“*请求参数sign的生成方法*”。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| accessKey      | 接口访问标识    | true  | String | 44   | 渠道请求访问标识，固定值。渠道方提交公钥后由存证平台生成，参见“*知金链平台返回信息说明*”。                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| random         | 随机字符串      | true  | String | 16   | 请求随机字符串。由渠道生成的32位随机字符串，每次请求的随机串必须重新生成。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| channelId      | 渠道ID          | true  | String | 4    | 渠道ID。由知金链存证平台生成，参见“*知金链平台返回信息说明*”。 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| channelOrdersn | 渠道订单号      | true  | String | 50   | 渠道的存证订单唯一标识。每个渠道的订单号不可重复，重复则以时间更新的订单为准。 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| requestTime    | 请求时间        | true  | String | 15   | 本次请求的发起时间。与服务器的标准时间差距不可大于5min，否则请求无效。 格式：yyyyMMdd-HHmmss 示例：“20170911-134211”，表示2017年9月11日，13点42分11秒。 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                          |
| attestFileType | 文件存证说明    | true  | String | 1    | 文件存证说明，说明本次存证是否包含文件。取值： 0 本次存证不包含存证文件信息。这种情况下，本次存证的实际内容为attestMsg字段内容；同时以下几个字段 filetType/fileName/fileSize/fileHash/fileAddr，必须为空。 1 本次存证包含存证文件，但是只传输文件描述信息和hash，不包括文件的地址。即知金链存证平台不负责存证文件的存储。filetType/fileName/fileSize/fileHash不可为空，fileAddr必须为空。 2 本次存证包含存证文件，且该次请求上传了文件。以下字段：fileType/fileName/fileSize/fileHash/fileAddr，必须非空，且fileSize、fileHash与实际的文件对应。 参与合作方签名。 |
| fileType       | 存证文件类型    | true  | String | 2    | 确定存证文件的类型，包括：1文字\\2图片\\3视频\\4音频\\5压缩\\6其他 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| fileName       | 文件名称        | true  | String | 80   | 存证文件名称。 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| fileSize       | 文件长度        | true  | String | 20   | 存证内容文件长度，字节为单位。 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| fileHash       | 文件哈希值      | true  | String | 44   | 客户原始文件的国密SM3算法摘要，base64编码形式的字符串。 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| fileAddr       | 文件OSS传输地址 | true  | String | 500  | 存证源文件的临时OSS地址。用于存证平台获取用户存证源文件文件，进行后续的校验、存储等操作。                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| attestMsg      | 存证自定义信息  | false | String | 1000 | 合作方自定义的存证信息。可以是存证具体内容的描述；格式自定义，建议采用json。 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ownerType      | 权属人类型      | true  | String | 1    | 权属人类型，包括自然人、法人、其他三种类型。 1为自然人，2为法人，9为其他 权属人信息会在出证明的时候使用。 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| ownerId        | 权属人身份标识  | true  | String | 18   | 权属人身份标识。当权属人类型是自然人时，填写身份证号；当前权属人类型是法人时，填写统一社会信用代码。 例：413025198809091122 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                                                      |
| ownerName      | 权属人名称      | true  | String | 64   | 权属人名称。 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| duration       | 存证时间长度    | true  | String | 5    | 以天为单位的时间长度，十进制表示。 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| agentName      | 代理人姓名      | true  | String | 32   | 本次业务的代理人名称。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| agentPhone     | 代理人电话      | true  | String | 11   | 代理人联系方式。格式：区号+电话 例：01088886666                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| agentEmail     | 代理人邮箱      | true  | String | 100  | 代理人邮箱。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| bizSign        | 渠道签名        | true  | String | 88   | 合作方采用私钥对本存证记录数据的签名。具体方法参见“[合作方的订单签名](#渠道的订单签名)”。                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

请求参数示例：

| &accessKey=2kDv8FXEzb69pk261PXPQ65KezG2fzbbHX7SrUEYkkabk74yHa&agentEmail=e98a19c77ad\@.com&agentName=agent3fb0d&agentPhone=4590904&bizSign=Ln4P8Jmk/ws+PBek7xjjEh+t1QoDGlqEqftGIvuI6CiEru9yMeHHyAaJSx0gqAGxF3GP3i/4ClIb85wayq2ZcA==&bizType=1&chained=1&channelId=005&channelOrdersn=ordersnc428e36af&channelUserid=453&description=描述:{"accessKey":"2kDv8FXEzb69pk261PXPQ65KezG2fzbbHX7SrUEYkkabk74yHa","agentEmail":"e98a19c77ad\@.com","agentName":"agent3fb0d","agentPhone":"4590904","biz&duration=3&fileAddr=http://osstestoss.oss-cn-beijing.aliyuncs.com/%E6%B5%8B%E8%AF%95-ordersnc428e36af?Expires=1512703606&OSSAccessKeyId=LTAIBZFtpYe3Cmdn&Signature=TqCMw%2Fnsms1dOMShfVdxlEioDYE%3D&fileHash=Xk0LNidH+LEP8Q/f3mGDqi9ww63JnxtVHOEeojrrH+k=&fileName=测试-ordersnc428e36af&fileSize=500&fileType=.669&ownerId=ownerid1&ownerName=权属人d8a3&ownerType=1&price=150&random=c7c782567cd846f6841e65f0e6984861&requestTime=20171118-112645 |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|


要求说明：

1.  响应结果说明

以JSON格式数据返回结果。调用方可以根据success、status字段进行业务逻辑判断，按照建议进行后续操作。

| 参数    | 描述                                                                                                                                                         |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|
| success | 本次请求处理结果。 取值范围:true，说明存证平台已经成功接受此请求； false，存证平台未成功接受请求，需要参照status和msg字段进行响应处理。                      |
| status  | 本次请求处理结果的状态码。客户端可以根据状态码进行对应的后续处理。 当前订单请求结果的状态码,与msg相互对应。参见“[JsonResult状态说明](#JsonResult状态说明)”。 |
| msg     | 本次请求处理结果说明，与status状态码相互对应。参见“[JsonResult状态说明](#JsonResult状态说明)”。                                                              |
| obj     | 返回结果对象。以JSON形式返回。                                                                                                                               |

>   JsonResult状态说明:

说明：

Status=0 正确返回，存证请求接受完成。

Status\<0，请求参数问题或其他问题，需要调用方根据接口文档进行调整。

Status\>0,存证平台问题，需要调用方联系平台解决。

| success | status | msg                                                     | 建议                                                   |
|---------|--------|---------------------------------------------------------|--------------------------------------------------------|
| true    | 0      | 存证请求接收完成。                                      | 无。                                                   |
| false   | \-1    | 该channelOrdersn重复提交。                              | 无。                                                   |
| false   | \-2    | 请求参数不合法，详情根据请求参数确定。                  | 核实请求参数的长度、是否为空、是否符合接口规定的格式。 |
| false   | \-3    | 请求时间requestTime格式错误.请参考yyyyMMdd-HHmmss格式。 | 核实请求时间格式。                                     |
| false   | \-4    | 请求随机数不合法。                                      | 请采用请求随机数。                                     |
| false   | \-5    | 渠道ID不存在。                                          | 核实渠道ID是否正确。                                   |
| false   | \-6    | 请求标识accessKey不匹配该渠道accessKey。                | 采用正确的渠道标识。                                   |
| false   | \-7    | 请求签名类型signType不匹配。                            | 核实签名类型。                                         |
| false   | \-8    | 请求签名sign校验未通过。                                | 核实签名。                                             |
| false   | \-9    | 订单签名bizSign校验未通过。                             | 核实订单签名。                                         |
| false   | \-10   | 渠道订单号channelOrdersn已存在。                        | 核实渠道订单号。                                       |
| false   | 1      | 业务异常。                                              | 重试请求，或者联系管理员。                             |

五. 文件存证续期业务

1.  流程说明

续期存证是对原始文件、Hash、自定义信息进行后续时间周期的存证。每次续期都在存证平台产生一个新的订单。

文件存证续期业务的功能为：接收用户的存证续期请求，并返回文件存证续期结果。文件存证续期业务通过文件存证续期请求及文件存证续期完成两个接口实现，其流程如下图所示：

![](media/a46b3aa7917e0f5f52477d779a7dbeb4.png)

>   图3 文件存证续期业务流程图

业务流程说明：

1. 合作方发起文件存证续期请求。

2. 存证系统进行文件存证信息的更新。通知合作方文件存证续期操作完成。

1.  存证平台实现接口

2.  接口说明

>   由合作方提供，供知金链存证平台调用，用于接收文件存证续期请求。

1.  请求地址

>   interface/attestContinue

1.  接口形式

>   Http POST请求。

1.  请求参数

| 参数名                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 数据项               | 必选  | 类型   | 长度 | 说明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------|-------|--------|------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| signType                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 签名类型             | true  | String | 10   | 请求的签名类型，目前固定值"MD5"。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| sign                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 签名                 | true  | String | 24   | 本次请求的参数签名。签名方法参见“*请求参数sign的生成方法*”。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| accessKey                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 接口访问标识         | true  | String | 44   | 渠道请求访问标识，固定值。渠道方提交公钥后由存证平台生成，参见“*知金链平台返回信息说明*”。                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| random                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 随机字符串           | true  | String | 16   | 请求随机字符串。由渠道生成的32位随机字符串，每次请求的随机串必须重新生成。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| channelId                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 渠道ID               | true  | String | 4    | 渠道ID。由知金链存证平台生成，参见“*知金链平台返回信息说明*”。 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| channelOrdersn                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 渠道订单号           | true  | String | 50   | 本次交易的渠道存证订单唯一标识。 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| olderOrdersn                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 原存证号             | true  | String | 18   | 初次存证时知金链平台返回的存证订单号，同一订单无论有多少续期或其他业务操作，续期时只传递初次存证订单号。 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| requestTime                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 请求时间             | true  | String | 15   | 本次请求的发起时间。与服务器的标准时间差距不可大于5min，否则请求无效。 格式：yyyyMMdd-HHmmss 示例：“20170911-134211”，表示2017年9月11日，13点42分11秒。 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                          |
| startTime                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 本次续期存证开始时间 | true  | String | 15   | 必须等于本条存证业务最新的一条保存订单的startTime+duration。（例：原始存证订单A；A进行续期，需要传入A的startTime+duration，产生续期订单A1；A进行第二次续期，需要传入A1的startTime+duration，产生续期订单A2）。 该时间可能是未来时间。 参与合作方签名。                                                                                                                                                                                                                                                                                                            |
| duration                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 存证时间长度         | true  | String | 5    | 以天为单位的时间长度，十进制表示。 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| attestFileType                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 文件存证说明         | true  | String | 1    | 文件存证说明，说明本次存证是否包含文件。取值： 0 本次存证不包含存证文件信息。这种情况下，本次存证的实际内容为attestMsg字段内容；同时以下几个字段 filetType/fileName/fileSize/fileHash/fileAddr，必须为空。 1 本次存证包含存证文件，但是只传输文件描述信息和hash，不包括文件的地址。即知金链存证平台不负责存证文件的存储。filetType/fileName/fileSize/fileHash不可为空，fileAddr必须为空。 2 本次存证包含存证文件，且该次请求上传了文件。以下字段：fileType/fileName/fileSize/fileHash/fileAddr，必须非空，且fileSize、fileHash与实际的文件对应。 参与合作方签名。 |
| fileType                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 存证文件类型         | true  | String | 2    | 确定存证文件的类型，包括：1文字\\2图片\\3视频\\4音频\\5压缩\\6其他。 与原始存证订单相同。 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| fileName                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 文件名称             | true  | String | 80   | 存证文件名称。 与原始存证订单相同。 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| fileSize                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 文件长度             | true  | String | 20   | 存证内容文件长度，字节为单位。 与原始存证订单相同。 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| fileHash                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 文件哈希值           | true  | String | 44   | 客户原始文件的sha256摘要，base64编码形式的字符串。 与原始存证订单相同。 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| attestMsg                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 存证自定义信息       | false | String | 1000 | 合作方自定义的存证信息。可以是存证具体内容的描述；格式自定义，建议采用json。 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ownerType                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 权属人类型           | true  | String | 1    | 权属人类型，包括自然人、法人、其他三种类型。 1为自然人，2为法人，9为其他 与原始存证订单相同。 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ownerId                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 权属人身份标识       | true  | String | 18   | 权属人身份标识。当权属人类型是自然人时，填写身份证号；当前权属人类型是法人时，填写统一社会信用代码。 例：413025198809091122 与原始存证订单相同。 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                                 |
| ownerName                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 权属人名称           | true  | String | 64   | 权属人名称。 与原始存证订单相同。 参与合作方签名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| agentName                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 代理人姓名           | true  | String | 32   | 本次业务的代理人名称。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| agentPhone                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 代理人电话           | true  | String | 11   | 代理人联系方式。格式：区号+电话 例：01088886666                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| agentEmail                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 代理人邮箱           | true  | String | 100  | 代理人邮箱。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| bizSign                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 渠道签名             | true  | String | 88   | 渠道采用私钥对本存证记录数据的签名。具体方法参见“*合作方的订单签名*”。 注意：此处的参与生成bizSign的字段                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 请求参数示例： &accessKey=2kDv8FXEzb69pk261PXPQ65KezG2fzbbHX7SrUEYkkabk74yHa&agentEmail=5ff2ac62997\@.com&agentName=agentc1638&agentPhone=2295753&bizSign=Zf9SpjnqAsTg2coRd5WyuCf9Q0TjuDvROLY/TNLS48p6O7kJRXj8Si3DuL3gtRWR1TBEu7CXF71HFlecFGmBaQ==&bizType=6&chained=1&channelId=005&channelOrdersn=ordersn5bef7d894&channelUserid=5e4&description=描述:{"accessKey":"2kDv8FXEzb69pk261PXPQ65KezG2fzbbHX7SrUEYkkabk74yHa","agentEmail":"5ff2ac62997\@.com","agentName":"agentc1638","agentPhone":"2295753","biz&duration=4&fileAddr=http://osstestoss.oss-cn-beijing.aliyuncs.com/yyyyyy-ordersn2cc68e727?Expires=1513164333&OSSAccessKeyId=LTAIBZFtpYe3Cmdn&Signature=lL31UcWVoioarybZh3ZxQyY0%2BNI%3D&fileHash=Fo/lyn+ZXM/ZOUHLSfuYvjC4DX3Onh4A/cAfoZHOu3g=&fileName=yyyyyy-ordersn5bef7d894&fileSize=99691&fileType=.027&ownerId=ownerid7&ownerName=存证人8bed&ownerType=1&price=150&random=5ac19182dcf3408f86075a0bbe97a3fa&requestTime=20171127-135023 |                      |       |        |      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |

2.  返回结果

以JSON格式数据返回结果。调用方可以根据success、status字段进行业务逻辑判断，按照建议进行后续操作。

| 参数    | 描述                                                                                                                                                             |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| success | 本次请求处理结果。 取值范围:true,false。参见“*JsonResult状态说明*”。                                                                                             |
| status  | 本次请求处理结果的状态码。客户端可以根据状态码进行对应的后续处理。 当前订单请求结果的状态码,与msg相互对应。参见“[JsonResult状态说明](#续期JsonResult状态说明)”。 |
| msg     | 本次请求处理结果说明，与status状态码相互对应。参见“[JsonResult状态说明](#续期JsonResult状态说明)”。                                                              |
| obj     | 返回结果对象。以JSON形式返回                                                                                                                                     |

>   JsonResult状态说明:

| success | status | msg                                                         | 建议                                                   |
|---------|--------|-------------------------------------------------------------|--------------------------------------------------------|
| true    | 1      | 续期请求成功。                                              | 无。                                                   |
| false   | \-1    | 该channelOrdersn重复提交。                                  | 无。                                                   |
| false   | \-2    | 请求参数不合法，详情根据请求参数确定                        | 核实请求参数的长度、是否为空、是否符合接口规定的格式。 |
| false   | \-3    | 请求时间requestTime格式错误.请参考yyyyMMdd-HHmmss格式。     | 核实请求时间格式。                                     |
| false   | \-4    | 请求随机数不合法.                                           | 请采用请求随机数。                                     |
| false   | \-5    | 渠道ID不存在。                                              | 核实渠道ID。                                           |
| false   | \-6    | 请求标识accessKey不匹配该渠道accessKey                      | 采用正确的渠道标识。                                   |
| false   | \-7    | 请求签名类型signType不匹配.                                 | 核实签名类型。                                         |
| false   | \-8    | 请求签名sign校验未通过.                                     | 核实签名。                                             |
| false   | \-9    | 订单签名bizSign校验未通过                                   | 核实订单签名。                                         |
| false   | \-10   | 渠道订单号(channelOrdersn)已存在.                           | 核实渠道订单号。                                       |
| false   | \-11   | 续期订单号不存在,无法续期.                                  | 核实续期订单号。                                       |
| false   | \-12   | 渠道ID(channelId)与待续期订单的channelId不匹配.             | 核实渠道ID。                                           |
| false   | \-13   | 渠道用户ID(channelUserId)与待续期订单的channelUserId不匹配. | 核实渠道用户ID。                                       |
| false   | \-14   | 渠道订单签名(bizType)与待续期订单的bizType不匹配.           | 核实渠道订单签名。                                     |
| false   | \-15   | 文件名称(fileName)与待续期订单的fileName不匹配.             | 核实文件名称。                                         |
| false   | \-16   | 文件类型(fileType)与待续期订单的fileType不匹配.             | 核实文件类型。                                         |
| false   | \-17   | 文件长度(fileSize)与待续期订单的fileSize不匹配.             | 核实文件长度。                                         |
| false   | \-18   | 文件Hash值(fileHash)与待续期订单的fileHash不匹配.           | 核实文件Hash值。                                       |
| false   | \-19   | 存证人类型(ownerType)与待续期订单的ownerType不匹配.         | 核实存证人类型。                                       |
| false   | \-20   | 存证人姓名(ownerName)与待续期订单的ownerName不匹配.         | 核实存证人姓名。                                       |
| false   | \-21   | 存证人身份标识(ownerId)与待续期订单的ownerId不匹配.         | 核实存证人身份标识。                                   |
| false   | \-22   | 存证开始时间(startTime)不正确.                              | 核实存证开始时间。                                     |
| false   | 1      | 业务异常                                                    | 重试请求，或者联系管理员。                             |

六、合作方实现接口

1.  接口说明

由合作方提供，供知金链存证平台调用，通知文件存证和续期业务的执行情况。

1.  请求地址

合作方在[合作方注册](#渠道注册)阶段提供给存证平台的信息，用于接受文件存证完成通知信息。

1.  接口形式

Http POST请求

1.  请求参数

| 参数名         | 数据项                | 必选  | 类型   | 长度 | 说明                                                                                                                                                                                                      |
|----------------|-----------------------|-------|--------|------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| signType       | 签名类型              | true  | String | 10   | 请求的签名类型，目前固定值"MD5"。                                                                                                                                                                         |
| sign           | 签名                  | true  | String | 24   | 本次请求的参数签名。签名方法参见“*请求参数签名算法*”。                                                                                                                                                    |
| random         | 随机字符串            | true  | String | 16   | 请求随机字符串。由渠道生成的32位随机字符串，每次请求的随机串必须重新生成。                                                                                                                                |
| channelOrdersn | 渠道订单号            | true  | String | 50   | 渠道的存证订单唯一标识。用于关联存证订单。                                                                                                                                                                |
| success        | 订单处理结果          | true  | String | 20   | 当前订单处理结果。 取值范围:true，说明存证平台已经完成该存证订单，此时ordersn、platformSign非空。 false，存证平台未成功完成存证订单，需要参照status和msg字段进行响应处理；此时ordersn、platformSign为空。 |
| status         | 对应处理状态          | true  | String | 10   | 当前订单处理结果的状态码,与msg相互对应。参见“[请求参数说明](#请求参数说明)”。                                                                                                                             |
| msg            | 订单处理详细信息      | true  | String | 20   | 当前订单处理结果的详细信息,与status状态码相互对应。参见“[请求参数说明](#请求参数说明)”。                                                                                                                  |
| ordersn        | 存证平台的 唯一存证号 | false | String | 18   | 知金链存证平台生成的唯一订单存证号。                                                                                                                                                                      |
| startTime      | 当前存证 起始时间     | true  | String | 15   | 存证平台返回的当前存证有效起始时间。                                                                                                                                                                      |
| platformSign   | 存证平台的订单签名    | false | String | 24   | 存证平台对订单的签名。参见“*存证平台的订单签名*”                                                                                                                                                          |

2.  请求参数（success、status、msg）说明:

| success | status | msg                 | 建议                       |
|---------|--------|---------------------|----------------------------|
| true    | 0      | 存证成功            | 无。                       |
| false   | \-25   | 文件长度不匹配。    | 核实文件长度。             |
| false   | \-26   | 文件Hash不匹配。    | 核实文件Hash值。           |
| false   | \-28   | OSS地址传输错误。   | 核实下载地址。             |
| false   | 2      | 获取文件流异常。    | 重试请求，或者联系管理员。 |
| false   | 3      | 请求oss服务器超时。 | 重试请求，或者联系管理员。 |

接口功能：

返回结果说明：

>   JSON格式数据。

返回结果示例：

>   {

>   "success":true,

>   "status":"0",

>   "msg":"文件存证通知接收完成"

>   "data":"参数信息"

>   }

>   其他情况，返回描述结果的Json字符串信息：

返回结果示例：

>   {

>   "success":false,

>   "status":"-1",

>   "msg":"处理失败"

>   "data":"参数信息"

>   }

七、订单信息查询

1.  接口说明

由知金链存证平台提供，供合作方调用，用于查询知金链平台存证订单信息。返回当前记录的存证订单信息。

1.  请求地址

/interface/queryAttest

1.  接口形式

Http POST请求。（同步返回查询结果）

1.  请求参数

| 参数名                                                                                                                                                                                                                                                                               | 数据项       | 必选 | 类型   | 长度 | 说明                                                                                                     |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------|------|--------|------|----------------------------------------------------------------------------------------------------------|
| signType                                                                                                                                                                                                                                                                             | 签名类型     | true | String | 10   | 请求的签名类型，目前固定值"MD5"。                                                                        |
| sign                                                                                                                                                                                                                                                                                 | 签名         | true | String | 24   | 本次请求的参数签名。签名方法参见“*请求参数sign的生成方法*”。                                             |
| accessKey                                                                                                                                                                                                                                                                            | 接口访问标识 | true | String | 44   | 渠道请求访问标识，固定值。渠道方提交公钥后由存证平台生成，参见“*知金链平台返回信息说明*”。               |
| random                                                                                                                                                                                                                                                                               | 随机字符串   | true | String | 16   | 请求随机字符串。由渠道生成的32位随机字符串，每次请求的随机串必须重新生成。                               |
| channelId                                                                                                                                                                                                                                                                            | 渠道ID       | true | String | 4    | 渠道ID。由知金链存证平台生成，参见“[知金链平台返回信息说明](#知金链平台返回信息说明)”。 参与合作方签名。 |
| ordersn                                                                                                                                                                                                                                                                              | 存证号       | true | String | 18   | 查询该ordersn对应的存证记录信息。 参与合作方签名。                                                       |
| bizSign                                                                                                                                                                                                                                                                              | 渠道签名     | true | String | 88   | 渠道采用私钥对本存证记录数据的签名。具体方法参见“*合作方的订单签名*”。 注意：此处的参与生成bizSign的字段 |
| 请求参数示例： &accessKey=2kDv8FXEzb69pk261PXPQ65KezG2fzbbHX7SrUEYkkabk74yHa&channelId=005&ordersn=005341171106000002&random=qewqlkzxcv&publicKey=04ea3d76b9afdcce27ec9b03224f4080fddaabbd95b3d93b5946b5ca5d2a1b6c5a6b6d8bf6dcba2f2920dccb269e7ea0df825a52e2292593dac3051540b917265a |              |      |        |      |                                                                                                          |

2.  返回结果说明

以JSON格式数据返回结果。调用方可以根据success、status字段进行业务逻辑判断，按照建议进行后续操作。

| success | status | msg                                      | 建议                                                   |
|---------|--------|------------------------------------------|--------------------------------------------------------|
| true    | 0      | 找到该订单。                             | 无。                                                   |
| true    | 0      | 区块链上存在该订单。                     | 无。                                                   |
| true    | 0      | 订单暂未上链                             | 请稍后查询。                                           |
| false   | \-2    | 请求参数不合法，详情根据请求参数确定。   | 核实请求参数的长度、是否为空、是否符合接口规定的格式。 |
| false   | \-4    | 请求随机数不合法。                       | 请采用请求随机数。                                     |
| false   | \-5    | 渠道ID不存在。                           | 核实渠道ID。                                           |
| false   | \-6    | 请求标识accessKey不匹配该渠道accessKey。 | 采用正确的渠道标识。                                   |
| false   | \-7    | 请求签名类型signType不匹配。             | 核实签名类型。                                         |
| false   | \-8    | 请求签名sign校验未通过。                 | 核实签名。                                             |
| false   | \-9    | 订单签名bizSign校验未通过                | 核实订单签名。                                         |
| false   | \-23   | 未找到该订单。                           | 核实订单号是否正确。                                   |
| false   | \-24   | 订单已过期                               | 请为该订单续期                                         |
| false   | 1      | 业务异常。                               | 重试请求，或者联系管理员。                             |

八、原始存证文件下载

1.  接口说明

由知金链存证平台提供，供渠道方调用，用于渠道方下载存证上传时的源文件。

只有存在源文件的时候才可成功调用此接口。

>   请求地址：

>   http://cz.zhijl.com/store/fetchAttestFile

1.  接口形式

>   Http POST请求。

1.  请求参数

| 参数名    | 数据项       | 必选 | 类型   | 长度 | 说明                                                                                                                      |
|-----------|--------------|------|--------|------|---------------------------------------------------------------------------------------------------------------------------|
| signType  | 签名类型     | true | String | 10   | 请求的签名类型，目前固定值"MD5"。                                                                                         |
| sign      | 签名         | true | String | 24   | 本次请求的参数签名。签名方法参见“*请求参数sign的生成方法*”。                                                              |
| accessKey | 接口访问标识 | true | String | 44   | 渠道请求访问标识，固定值。渠道方提交公钥后由存证平台生成，参见“*知金链平台返回信息说明*”。                                |
| random    | 随机字符串   | true | String | 16   | 请求随机字符串。由渠道生成的32位随机字符串，每次请求的随机串必须重新生成。                                                |
| channelId | 渠道ID       | true | String | 4    | 渠道ID。由知金链存证平台生成，参见“[知金链平台返回信息说明](#知金链平台返回信息说明)”。 参与合作方签名。                  |
| ordersn   | 原存证号     | true | String | 18   | 初次存证时知金链平台返回的存证订单号，同一订单无论有多少续期或其他业务操作，下载时只传递初次存证订单号。 参与合作方签名。 |
| bizSign   | 渠道签名     | true | String | 88   | 渠道采用私钥对本存证记录数据的签名。具体方法参见“*合作方的订单签名*”。 注意：此处的参与生成bizSign的字段                  |

请求参数示例：

| &accessKey=29DQsxdm481LQjnfVMigS2BaDuDzDXaPKQBMzTm4WFwfwQc4L7&channelId=005&ordersn=005341171106000002&random=1&publicKey=04ea3d76b9afdcce27ec9b03224f4080fddaabbd95b3d93b5946b5ca5d2a1b6c5a6b6d8bf6dcba2f2920dccb269e7ea0df825a52e2292593dac3051540b917265a |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|


1.  返回结果

以JSON格式数据返回结果。调用方可以根据success、status字段进行业务逻辑判断，按照建议进行后续操作。

| success | status | msg                                      | 建议                                                   |
|---------|--------|------------------------------------------|--------------------------------------------------------|
| true    | 0      | 下载完毕。                               | 无。                                                   |
| false   | \-23   | 未找到该订单。                           | 核实订单号是否正确。                                   |
| false   | \-2    | 请求参数不合法，详情根据请求参数确定。   | 核实请求参数的长度、是否为空、是否符合接口规定的格式。 |
| false   | \-4    | 请求随机数不合法。                       | 请采用请求随机数。                                     |
| false   | \-5    | 渠道ID不存在。                           | 核实渠道ID。                                           |
| false   | \-6    | 请求标识accessKey不匹配该渠道accessKey。 | 采用正确的渠道标识。                                   |
| false   | \-7    | 请求签名类型signType不匹配。             | 核实签名类型。                                         |
| false   | \-8    | 请求签名sign校验未通过。                 | 核实签名。                                             |
| false   | 1      | 业务异常。                               | 重试请求，或者联系管理员。                             |

九、存证证书下载（未实现）

接口说明：

>   由知金链存证平台提供，供合作方调用，用于下载存证证书。根据知金链平台的订单号ordersn，返回该订单的存证证书文件流。

请求地址：

>   待定

接口形式：

>   Http POST请求。

请求参数：

| 待定 |
|------|


十. 密钥及算法

本章详细说明接口中涉及的合作方密钥、签名算法等。

1.  合作方密钥生成

提交存证相关请求信息的时候，需要合作方对订单的业务数据部分进行签名；同时合作方的公钥也参与生成本次请求的sign值。签名采用国密SM2算法进行,公钥、私钥的明文以hex表示。

参见类 GenChannelKeypair类生成方式。

1.  请求参数sign的生成方法

sign是双方在进行请求时对请求参数进行的签名（由于该参数sign仅单次请求使用，为了考虑生成和验证的速度，此处采用了md5进行摘要，而没采用私钥进行签名操作）。存证平台向合作方发起请求的时候，sign生成也采用此算法，此时采用的publicKey仍然是合作方提供的公钥。

参见类GenRequestSign类生成方式。

目前签名的摘要算法是MD5。

用户在签名之前需要准备请求参数、公钥。合作方的公钥生成参见“[合作方密钥生成](#渠道密钥生成)”。其他必须参数的生成参见具体的接口说明。签名sign生成的通用步骤如下：

1.  将除了signType、sign之外的所有请求参数按照参数名的字典顺序排列，采用‘=’连接参数名与参数值,都必须在签名中出现，采用‘&’连接多个参数，形成字符串。

2.  在连接的字符串后面添加合作方的公钥‘&publicKey=\${publicKey}’，形成待签名的字符串，其中\${publicKey}指采用hex编码的合作方SM2公钥。

3.  对待签名的字符串采用utf-8编码，生成MD5摘要，对摘要字节数组采用base64编码，输出最终签名sign。

4.  当参数为空时,拼接参数时,不写值。例:

>   sourceFileLength=&sourceFileName=&sourceFileType=

1.  签名的检验参照生成算法即可。

2.  合作方的订单签名bizSign

需要参与合作方签名bizSign生成的参数均在各个接口参数说明中标注了“参与合作方签名”。

1.  将本次请求的业务参数（仅包含接口文档中标注”参与合作方签名”的参数）按照参数名的字典顺序排列,都必须在签名中出现，按照&[参数名]=[参数值]形式依次拼接，形成字符串s_init。

2.  对s_init字符串采用utf-8编码生成字节数组，然后进行SM3摘要生成b_hash字节数组(java范例请参见common/channeldemo/demo示例代码)。

3.  以b_hash、ida、渠道SM2私钥生成签名信息，对签名字节数组采用base64编码，输出最终签名bizSign。

4.  当参数为空时,拼接参数时,不写值。例:

>   &sourceFileLength=&sourceFileName=&sourceFileType=

1.  参见类GenBizSign。

2.  存证平台的订单签名platformSign

存证平台的platformSign，是存证平台得到合作方上传的业务参数、bizSign、ordersn等完整业务信息后，依据存证平台的SM2密钥对、存证平台的IDA生成的签名。

签名的生成过程同“[合作方的订单签名bizSign](#渠道的订单签名)”，注意事项：

1.  除了参与bizSign生成的参数以外，还包括bizSign（渠道生成）、startTime（存证平台生成）、ordersn（存证平台生成）。

2.  “[合作方的订单签名bizSign](#渠道的订单签名)”，只是在第一步添加了参数bizSign。该过程由存证平台完成，当合作方收到参数后，可以仿照渠道订单签名重新生成一次sign，然后比较合作方的bizSign是否合法。
